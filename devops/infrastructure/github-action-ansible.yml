---
# Testing github actions with ansible playnook

- name: Setup instance
  hosts: all

  tasks:
    - name: Debug information
      debug:
        msg: "Variables are: {{ hostvars }}"

    - name: Git checkout
      git:
        repo: "{{ git_repo }}"
        dest: "{{ remote_code_path }}"
        version: "{{ branch_name }}"

    - name: Install boto3 python package
      pip:
        name: boto3

    - name: Basic AMI Creation
      amazon.aws.ec2_ami:
        instance_id: "{{ instance_id }}"
        wait: yes
        name: "joystream-{{ branch_name }}"
        launch_permissions:
          group_names: ['all']
      delegate_to: localhost
