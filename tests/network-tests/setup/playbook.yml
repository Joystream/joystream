- hosts: 127.0.0.1
  user: root
  become: yes
  become_method: sudo
  tasks:
    - name: install pip
      apt: name=python-pip state=present
    - name: install docker-py
      pip: name=docker-py
    - name: Install yarn with npm
      npm:
        name: yarn
        global: yes
    # - name: create node docker image
    #   shell: ./scripts/build-joystream-node-docker-image.sh
    #   args:
    #     chdir: ../../../
    - name: run docker container
      docker_container:
        name: 'joystream-node'
        image: 'joystream/node'
        command: --dev --ws-external
        ports:
          - '9944:9944'
        state: started
    - name: execute network tests
      shell: yarn test >> alog.txt
      args:
        chdir: ../
    - name: stop docker container
      docker_container:
        name: 'joystream-node'
        state: stopped
